<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#00d5ff">
    <meta name="description" content="Urbindex - Community-driven urban exploration mapping platform">
    <meta name="keywords" content="urban exploration, mapping, community, locations, abandoned places">
    <meta name="author" content="Urbindex Team">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Urbindex">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Urbindex">
    
    <title>Urbindex - Urban Exploration Network</title>
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style">
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    
    <!-- External Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/urbindex-optimized.css">
    <link rel="stylesheet" href="css/enhanced-styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸ™ï¸%3C/text%3E%3C/svg%3E">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">URBINDEX</div>
            <div class="loading-spinner"></div>
            <div class="loading-text">Initializing urban exploration network...</div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app" id="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">URBINDEX</div>
                <div class="tagline">Urban Exploration Network</div>
            </div>
            
            <div class="header-center">
                <div class="status" id="connection-status">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="status-text">Connecting...</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="btn btn-primary" id="auth-btn">
                    <i class="fas fa-user"></i>
                    <span>Sign In</span>
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-view="map" data-tooltip="Interactive Map">
                <i class="fas fa-map"></i>
                <span>Map</span>
            </button>
            <button class="nav-btn" data-view="locations" data-tooltip="Your Locations">
                <i class="fas fa-map-marker-alt"></i>
                <span>Locations</span>
            </button>
            <button class="nav-btn" data-view="forum" data-tooltip="Community Forum">
                <i class="fas fa-comments"></i>
                <span>Forum</span>
            </button>
            <button class="nav-btn" data-view="profile" data-tooltip="Your Profile">
                <i class="fas fa-user-circle"></i>
                <span>Profile</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Map View -->
            <div class="view active" id="map-view">
                <!-- Welcome Message -->
                <div class="welcome" id="welcome-message">
                    <h3><i class="fas fa-compass"></i> Welcome to Urbindex</h3>
                    <p>Discover and share urban exploration locations with a global community. Click anywhere on the map to add new locations, or explore existing markers to learn about hidden gems in your area.</p>
                    <div class="welcome-actions">
                        <button class="btn btn-small" onclick="document.getElementById('welcome-message').style.display='none'">
                            <i class="fas fa-times"></i> Dismiss
                        </button>
                    </div>
                </div>
                
                <div class="map-layout">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <!-- Activity Feed -->
                        <div class="panel">
                            <div class="panel-title">
                                <i class="fas fa-activity"></i>
                                Recent Activity
                            </div>
                            <div id="activity-feed" class="loading">
                                Loading recent activity...
                            </div>
                        </div>

                        <!-- Community Panel -->
                        <div class="panel">
                            <div class="panel-title">
                                <i class="fas fa-users"></i>
                                Community
                            </div>
                            <div id="community-info" class="loading">
                                Loading community data...
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="panel">
                            <div class="panel-title">
                                <i class="fas fa-chart-bar"></i>
                                Quick Stats
                            </div>
                            <div id="quick-stats">
                                <div class="stat-grid">
                                    <div class="stat-item">
                                        <div class="stat-value" id="total-locations">-</div>
                                        <div class="stat-label">Total Locations</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="active-explorers">-</div>
                                        <div class="stat-label">Active Explorers</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <!-- Map Container -->
                    <div class="map-container">
                        <div id="map" role="application" aria-label="Interactive exploration map"></div>
                        
                        <!-- Map Controls -->
                        <div class="map-controls">
                            <button class="map-control-btn" id="locate-btn" data-tooltip="Find My Location">
                                <i class="fas fa-crosshairs"></i>
                            </button>
                            <button class="map-control-btn" id="fullscreen-btn" data-tooltip="Fullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                        
                        <!-- Map Legend -->
                        <div class="map-legend">
                            <div class="legend-title">Location Types</div>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <div class="legend-marker" style="background: #ff3860;"></div>
                                    <span>Abandoned</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-marker" style="background: #209cee;"></div>
                                    <span>Rooftop</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-marker" style="background: #23d160;"></div>
                                    <span>Tunnel</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-marker" style="background: #ffdd57;"></div>
                                    <span>Industrial</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Locations View -->
            <div class="view" id="locations-view">
                <div class="view-header">
                    <h2><i class="fas fa-map-marker-alt"></i> My Locations</h2>
                    <div class="view-actions">
                        <button class="btn" id="export-locations-btn">
                            <i class="fas fa-download"></i>
                            Export
                        </button>
                        <button class="btn btn-primary" id="add-location-header-btn">
                            <i class="fas fa-plus"></i>
                            Add Location
                        </button>
                    </div>
                </div>
                
                <div class="locations-filters">
                    <div class="filter-group">
                        <label class="form-label">Filter by Category</label>
                        <select class="select" id="category-filter">
                            <option value="">All Categories</option>
                            <option value="abandoned">Abandoned</option>
                            <option value="rooftop">Rooftop</option>
                            <option value="tunnel">Tunnel</option>
                            <option value="industrial">Industrial</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="form-label">Filter by Risk</label>
                        <select class="select" id="risk-filter">
                            <option value="">All Risk Levels</option>
                            <option value="low">Low Risk</option>
                            <option value="moderate">Moderate Risk</option>
                            <option value="high">High Risk</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="form-label">Search</label>
                        <input class="input" type="text" id="locations-search" placeholder="Search locations...">
                    </div>
                </div>
                
                <div id="locations-grid" class="loading">
                    Loading your locations...
                </div>
            </div>

            <!-- Forum View -->
            <div class="view" id="forum-view">
                <div class="view-header">
                    <h2><i class="fas fa-comments"></i> Community Forum</h2>
                    <div class="view-actions">
                        <button class="btn btn-primary" id="new-post-btn">
                            <i class="fas fa-plus"></i>
                            New Post
                        </button>
                    </div>
                </div>
                
                <div class="forum-categories">
                    <button class="category-btn active" data-category="all">All Posts</button>
                    <button class="category-btn" data-category="general">General</button>
                    <button class="category-btn" data-category="locations">Locations</button>
                    <button class="category-btn" data-category="safety">Safety</button>
                    <button class="category-btn" data-category="gear">Gear</button>
                </div>
                
                <div id="forum-posts" class="loading">
                    Loading forum posts...
                </div>
            </div>

            <!-- Profile View -->
            <div class="view" id="profile-view">
                <div class="view-header">
                    <h2><i class="fas fa-user-circle"></i> Profile</h2>
                    <div class="view-actions">
                        <button class="btn" id="edit-profile-btn">
                            <i class="fas fa-edit"></i>
                            Edit Profile
                        </button>
                    </div>
                </div>
                
                <div id="profile-content" class="loading">
                    Loading profile...
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="fab" id="add-location-fab" data-tooltip="Add New Location">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Add Location Modal -->
    <div class="modal" id="location-modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">
                <i class="fas fa-times"></i>
            </button>
            
            <h3 id="modal-title">
                <i class="fas fa-map-marker-alt"></i>
                Add New Location
            </h3>
            
            <form id="location-form" novalidate>
                <div class="form-group">
                    <label class="form-label" for="location-name">
                        <i class="fas fa-tag"></i>
                        Location Name *
                    </label>
                    <input class="input" type="text" id="location-name" name="name" required 
                           placeholder="Enter a descriptive name">
                    <div class="form-error" id="name-error"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="location-description">
                        <i class="fas fa-align-left"></i>
                        Description *
                    </label>
                    <textarea class="textarea" id="location-description" name="description" required 
                              placeholder="Describe the location, access points, notable features..."></textarea>
                    <div class="form-error" id="description-error"></div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="location-category">
                            <i class="fas fa-folder"></i>
                            Category
                        </label>
                        <select class="select" id="location-category" name="category">
                            <option value="abandoned">Abandoned Building</option>
                            <option value="rooftop">Rooftop Access</option>
                            <option value="tunnel">Underground/Tunnel</option>
                            <option value="industrial">Industrial Site</option>
                            <option value="water">Water Feature</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="location-risk">
                            <i class="fas fa-exclamation-triangle"></i>
                            Risk Level
                        </label>
                        <select class="select" id="location-risk" name="riskLevel">
                            <option value="low">Low - Safe access</option>
                            <option value="moderate">Moderate - Some caution needed</option>
                            <option value="high">High - Experienced only</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-map-pin"></i>
                        Coordinates
                    </label>
                    <div class="coordinates-display" id="coordinates-display">
                        Click on the map to set location
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="location-tags">
                        <i class="fas fa-tags"></i>
                        Tags (optional)
                    </label>
                    <input class="input" type="text" id="location-tags" name="tags" 
                           placeholder="urban, photography, historic (comma separated)">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-location-btn">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" id="save-location-btn">
                        <i class="fas fa-save"></i>
                        Save Location
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Application Script -->
    <script src="js/enhanced-app.js"></script>
    
    <!-- Loading Screen Script -->
    <script>
        // Show loading screen initially
        document.addEventListener('DOMContentLoaded', function() {
            const loadingScreen = document.getElementById('loading-screen');
            const app = document.getElementById('app');
            
            // Simulate loading time and wait for app initialization
            let loadingComplete = false;
            let appReady = false;
            
            // Minimum loading time
            setTimeout(() => {
                loadingComplete = true;
                checkReady();
            }, 2000);
            
            // Listen for app ready event
            document.addEventListener('app-ready', () => {
                appReady = true;
                checkReady();
            });
            
            function checkReady() {
                if (loadingComplete && appReady) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        app.style.display = 'flex';
                        app.style.opacity = '0';
                        setTimeout(() => {
                            app.style.opacity = '1';
                        }, 50);
                    }, 500);
                }
            }
            
            // Fallback - show app after 5 seconds regardless
            setTimeout(() => {
                if (loadingScreen.style.display !== 'none') {
                    loadingScreen.style.display = 'none';
                    app.style.display = 'flex';
                    app.style.opacity = '1';
                }
            }, 5000);
        });
    </script>
    
    <style>
        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0a0a15, #111122);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }
        
        .loading-content {
            text-align: center;
            color: #f0f0ff;
        }
        
        .loading-logo {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00d5ff, #ae00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            letter-spacing: 2px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 213, 255, 0.3);
            border-top: 3px solid #00d5ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        .loading-text {
            color: #b0b0d0;
            font-size: 0.9rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Additional Styles */
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .tagline {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 300;
        }
        
        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-btn i {
            font-size: 0.9rem;
        }
        
        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .view-actions {
            display: flex;
            gap: 1rem;
        }
        
        .welcome-actions {
            margin-top: 1rem;
        }
        
        .locations-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .forum-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }
        
        .category-btn {
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }
        
        .category-btn:hover {
            background: var(--quaternary-bg);
            color: var(--text-primary);
        }
        
        .category-btn.active {
            background: var(--neon-blue);
            color: var(--primary-bg);
            border-color: var(--neon-blue);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-error {
            color: var(--danger);
            font-size: var(--font-size-xs);
            margin-top: 0.25rem;
            display: none;
        }
        
        .coordinates-display {
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 0.75rem;
            font-family: var(--font-mono);
            color: var(--neon-blue);
            font-size: var(--font-size-sm);
        }
        
        .map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 1000;
        }
        
        .map-control-btn {
            width: 40px;
            height: 40px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .map-control-btn:hover {
            background: var(--neon-blue);
            color: var(--primary-bg);
            border-color: var(--neon-blue);
        }
        
        .map-legend {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }
        
        .legend-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }
        
        .legend-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid white;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 0.5rem;
            background: var(--tertiary-bg);
            border-radius: var(--radius-md);
        }
        
        /* Mobile Responsive Adjustments */
        @media (max-width: 768px) {
            .header-left .tagline {
                display: none;
            }
            
            .nav-btn span {
                display: none;
            }
            
            .view-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .view-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .locations-filters {
                grid-template-columns: 1fr;
            }
            
            .forum-categories {
                flex-wrap: wrap;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .map-legend {
                position: relative;
                margin-top: 1rem;
            }
            
            .legend-items {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }
    </style>
</body>
</html>