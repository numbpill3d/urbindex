<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a20">
    <meta name="description" content="Urbindex - Community-driven urban exploration mapping tool">
    <title>Urbindex</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
    <div id="splash-screen" class="active">
        <div class="splash-content">
            <pre class="splash-ascii neon-text">
 █    █ █████  ████   █████ █   █ ████   █████ █   █
 █    █ █   █  █   █    █   ██  █ █   █  █      █ █ 
  ████  █████  ████   █████ █   █ ████   █████   █  
            </pre>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="tagline">Explore. Mark. Share.</p>
        </div>
    </div>

    <!-- Scanline effect for retro look -->
    <div class="scanline"></div>
    
    <div id="app" class="hidden">
        <header>
            <div class="ascii-title-container">
                <pre class="ascii-title">
 █    █ █████  ████   █████ █   █ ████   █████ █   █
 █    █ █   █  █   █    █   ██  █ █   █  █      █ █ 
  ████  █████  ████   █████ █   █ ████   █████   █  
                </pre>
            </div>
            <div id="user-profile">
                <button id="login-button" class="neon-button">Sign In</button>
                <div id="user-info" class="hidden">
                    <img id="user-avatar" src="" alt="User avatar">
                    <span id="user-name"></span>
                </div>
            </div>
        </header>

        <nav>
            <button id="map-view-btn" class="nav-btn active">Map</button>
            <button id="leaderboard-btn" class="nav-btn">Leaderboard</button>
            <button id="my-locations-btn" class="nav-btn">My Spots</button>
            <button id="profile-btn" class="nav-btn">Profile</button>
            <button id="settings-btn" class="nav-btn">Settings</button>
        </nav>

        <main>
            <div id="map-container" class="view active">
                <div class="retro-layout">
                    <!-- Left side: Feed and announcements -->
                    <div class="left-panel">
                        <div class="announcement-board">
                            <h3 class="panel-title">Announcements</h3>
                            <div class="announcement-content">
                                <p>Welcome to the new Urbindex! Explore new features like crew territories, geocaching, and more.</p>
                            </div>
                        </div>
                        <div class="activity-feed">
                            <h3 class="panel-title">Activity Feed</h3>
                            <ul id="activity-feed-list" class="feed-list">
                                <!-- Feed items will be populated dynamically -->
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Right side: Map, marquee, and chat -->
                    <div class="right-panel">
                        <div class="online-users-marquee">
                            <div class="marquee-content">
                                <span>Online Users: </span>
                                <span id="online-users-list">Loading users...</span>
                            </div>
                        </div>
                        <div id="map" class="square-map"></div>
                        <div class="chat-box">
                            <div class="chat-messages" id="chat-messages">
                                <!-- Chat messages will be populated dynamically -->
                            </div>
                            <div class="chat-input-container">
                                <input type="text" id="chat-input" placeholder="Type a message..." class="chat-input">
                                <button id="chat-send-btn" class="chat-send-btn">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Map HUD Elements -->
                <div class="map-hud map-coordinates">Coordinates: <span id="current-coordinates">0.000, 0.000</span></div>
                <div class="map-hud map-zoom-level">Zoom: <span id="current-zoom">13</span></div>
                <div class="map-hud map-info-panel">
                    <div class="map-info-header">Location Info</div>
                    <div class="map-info-content" id="map-info-content">
                        <p>Hover over map elements to see details</p>
                    </div>
                </div>
                <div class="map-hud map-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--neon-pink);"></div>
                        <div class="legend-label">Abandoned</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--neon-blue);"></div>
                        <div class="legend-label">Water Source</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--neon-green);"></div>
                        <div class="legend-label">Camp Spot</div>
                    </div>
                </div>
                <button id="add-location-btn" class="floating-btn">+</button>
            </div>

            <div id="leaderboard-container" class="view">
                <h2>Top Explorers</h2>
                <ul id="leaderboard-list"></ul>
            </div>

            <div id="my-locations-container" class="view">
                <h2>My Exploration Spots</h2>
                <ul id="my-locations-list"></ul>
            </div>

            <div id="profile-container" class="view">
                <h2>User Profile</h2>
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar-container">
                            <img id="profile-avatar" src="" alt="Profile avatar">
                            <button id="change-avatar-btn" class="neon-button small">Change</button>
                        </div>
                        <div class="profile-info">
                            <h3 id="profile-name">Username</h3>
                            <p id="profile-joined">Joined: <span id="join-date">January 1, 2025</span></p>
                            <p id="profile-locations">Locations: <span id="location-count">0</span></p>
                        </div>
                    </div>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="stat-explored">0</span>
                            <span class="stat-label">Explored</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-shared">0</span>
                            <span class="stat-label">Shared</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="stat-rating">0</span>
                            <span class="stat-label">Rating</span>
                        </div>
                    </div>
                    <div class="profile-customization">
                        <h3>Customization</h3>
                        <div class="form-group">
                            <label for="display-name">Display Name</label>
                            <input type="text" id="display-name">
                        </div>
                        <div class="form-group">
                            <label for="user-bio">Bio</label>
                            <textarea id="user-bio" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="user-theme">Theme</label>
                            <select id="user-theme">
                                <option value="cyberpunk">Cyberpunk</option>
                                <option value="retro">Retro</option>
                                <option value="minimal">Minimal</option>
                            </select>
                        </div>
                        <button id="save-profile-btn" class="neon-button">Save Changes</button>
                    </div>
                </div>
            </div>

            <div id="settings-container" class="view">
                <h2>Settings</h2>
                <div class="setting-item">
                    <label for="offline-mode">Offline Mode</label>
                    <input type="checkbox" id="offline-mode">
                </div>
                <div class="setting-item">
                    <label for="sync-frequency">Sync Frequency</label>
                    <select id="sync-frequency">
                        <option value="realtime">Real-time</option>
                        <option value="hourly">Hourly</option>
                        <option value="daily">Daily</option>
                    </select>
                </div>
                <button id="logout-button" class="neon-button">Sign Out</button>
                <div class="app-info">
                    <p>Version: 1.0.0</p>
                    <p>Made with ♥ for urban explorers</p>
                </div>
            </div>
        </main>

        <!-- Location Modal -->
        <div id="location-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="modal-title">Add New Location</h2>
                <form id="location-form">
                    <div class="form-group">
                        <label for="location-name">Name</label>
                        <input type="text" id="location-name" required>
                    </div>
                    <div class="form-group">
                        <label for="location-category">Category</label>
                        <select id="location-category" required>
                            <option value="abandoned">Abandoned</option>
                            <option value="historical">Historical</option>
                            <option value="street-art">Street Art</option>
                            <option value="viewpoint">Viewpoint</option>
                            <option value="hidden-gem">Hidden Gem</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="location-description">Description</label>
                        <textarea id="location-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="location-notes">Notes</label>
                        <textarea id="location-notes" rows="3" placeholder="Add your personal notes about this location..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="location-image">Image Upload</label>
                        <input type="file" id="location-image" accept="image/*" multiple>
                        <div id="image-preview-container" class="image-preview-container"></div>
                    </div>
                    <div class="form-group">
                        <label for="location-risk">Risk Level</label>
                        <select id="location-risk" required>
                            <option value="safe">Safe</option>
                            <option value="questionable">Questionable</option>
                            <option value="unknown">Unknown</option>
                            <option value="hot">Hot</option>
                            <option value="high-risk">High Risk</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="location-type">Location Type</label>
                        <select id="location-type">
                            <option value="default">Default</option>
                            <option value="water">Water Source</option>
                            <option value="building">Abandoned Building</option>
                            <option value="power">Power Outlet</option>
                            <option value="camp">Sleeping/Camp Spot</option>
                            <option value="geocache">Geocache</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Coordinates</label>
                        <div class="coordinates-display">
                            <span id="location-lat"></span>, <span id="location-lng"></span>
                        </div>
                    </div>
                    <button type="submit" class="neon-button">Save Location</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/map.js"></script>
    <script src="js/locations.js"></script>
    <script src="js/comments.js"></script>
    <script src="js/ratings.js"></script>
    <script src="js/geocaching.js"></script>
    <script src="js/territories.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="js/app.js"></script>
    <script src="js/offline.js"></script>
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
